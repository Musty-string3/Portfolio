<!--ユーザー情報編集画面-->
<div class="container">
  <!--エラーメッセージ-->
  <div class="text-center">
    <%= render 'layouts/error_messages', resource: @user %>
  </div>
  <%= form_with model: @user, url: user_path(@user), method: :patch do |f| %>
    <div class="w-50 mx-auto">
      <!--ユーザーのアイコンのフォーム-->
      <div class="form-group">
        <%= f.file_field :profile_image, accept: "image/*", onchange: "profileImage(this)" %>
        <div class="text-center">
          <%= image_tag @user.get_profile_image(500, 500), class:"m-2 profile_image border border-dark rounded-circle", id:"profile_image" %>
          <span id="preview"></span>
        </div>
      </div>

      <!--ニックネーム-->
      <div class="form-group">
        <span class="mr-5">
          <%= f.label :name, "ニックネーム(最大20文字)" %>
        </span>
        <%= f.text_field :name, required: true, class:"form-control" %>
        <div><span id="user_name_countUp"><%= @user.name&.length || 0 %></span>/20文字</div>
      </div>
      <!--自己紹介文-->
      <div class="form-group">
        <span class="mr-5">
          <%= f.label :name, "自己紹介文(最大100文字)" %>
        </span>
        <%= f.text_area :introduction, required: true, class:"form-control" %>
        <div><span id="user_introduction_countUp"><%= @user.introduction&.length || 0 %></span>/100文字</div>
      </div>
    </div>
    <div class="mx-auto row justify-content-around w-50 pt-3">
      <%= f.submit "変更する", class:"btn btn-success mr-5" %>
      <!--退会ボタン-->
      <button type="button" class="btn btn-danger ml-5" data-toggle="modal" data-target="#exampleModal">
        退会する
      </button>
      <!--モーダルウィンドウ-->
      <%= render 'unsubscribe' %>
    </div>
  <% end %>
</div>

<script>
  function profileImage(obj){
    let fileReader;
    $('#preview').empty();
		fileReader = new FileReader();
		fileReader.onload = (function (e) {
		  $('#profile_image').hide();
			$('#preview').html('<img class="m-2 border border-dark rounded-circle profile_image" src="' + e.target.result + '">');
		});
		fileReader.readAsDataURL(obj.files[0]);
  }
</script>
